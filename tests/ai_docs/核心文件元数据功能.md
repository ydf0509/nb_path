# æ ¸å¿ƒæ–‡ä»¶å…ƒæ•°æ®æå–åŠŸèƒ½ - å®Œæˆè¯´æ˜

## âœ… æ–°å¢åŠŸèƒ½

å·²æˆåŠŸæ·»åŠ  **æ ¸å¿ƒæ–‡ä»¶å…ƒæ•°æ®æå–** åŠŸèƒ½ï¼Œè®©ä½ å¯ä»¥åœ¨é¡¹ç›®æ¦‚è¿°ä¸­åªæå–æ ¸å¿ƒå…¥å£æ–‡ä»¶çš„å…ƒæ•°æ®ï¼Œä¸åŒ…å«å®Œæ•´æºç ï¼

## ğŸ¯ è§£å†³çš„é—®é¢˜

### é—®é¢˜ï¼š
åœ¨ç»™ AI æä¾›é¡¹ç›®ä»£ç æ—¶ï¼Œå¦‚æœç›´æ¥åŒ…å«æ‰€æœ‰æ ¸å¿ƒæ–‡ä»¶çš„å®Œæ•´æºç ï¼š
- âŒ token æ¶ˆè€—å·¨å¤§ï¼ˆ1ä¸ªæ–‡ä»¶å¯èƒ½ 2000+ tokensï¼‰
- âŒ AI éœ€è¦é˜…è¯»å¤§é‡ä»£ç æ‰èƒ½ç†è§£ç»“æ„
- âŒ é‡è¦çš„å…¥å£ä¿¡æ¯è¢«æ·¹æ²¡åœ¨ä»£ç ç»†èŠ‚ä¸­

### è§£å†³æ–¹æ¡ˆï¼š
å…ˆåœ¨æ–‡æ¡£æœ€å‰é¢æå–æ ¸å¿ƒæ–‡ä»¶çš„ **å…ƒæ•°æ®**ï¼ˆç±»ã€æ–¹æ³•ã€ç­¾åï¼‰ï¼Œè®© AIï¼š
- âœ… ä¸€çœ¼çœ‹æ‡‚é¡¹ç›®çš„æ ¸å¿ƒå…¥å£
- âœ… å¿«é€Ÿç†è§£æ¯ä¸ªæ–‡ä»¶çš„ä½œç”¨
- âœ… èŠ‚çœ 90% çš„ tokens
- âœ… éœ€è¦æ—¶å†æŸ¥çœ‹è¯¦ç»†å®ç°

## ğŸ“ æ–°å¢/ä¿®æ”¹çš„æ–¹æ³•

### 1. `add_project_summary()` æ–¹æ³•å¢å¼º

**æ–°å¢å‚æ•°ï¼š**
- `project_root`: é¡¹ç›®æ ¹ç›®å½•
- `most_core_source_code_file_list`: æ ¸å¿ƒæ–‡ä»¶åˆ—è¡¨

**åŠŸèƒ½ï¼š**
åœ¨é¡¹ç›®æ¦‚è¿°ä¸­è‡ªåŠ¨æå–æŒ‡å®šæ ¸å¿ƒæ–‡ä»¶çš„å…ƒæ•°æ®ï¼ˆåªæœ‰ç»“æ„ï¼Œæ²¡æœ‰æºç ï¼‰

```python
def add_project_summary(
    self, 
    project_summary: str, 
    project_root: typing.Union[os.PathLike, str] = None,
    most_core_source_code_file_list: typing.List[str] = None,
) -> "AiMdGenerator":
    """
    æ·»åŠ é¡¹ç›®æ¦‚è¿°ï¼Œå¯é€‰åœ°åŒ…å«æ ¸å¿ƒæ–‡ä»¶çš„å…ƒæ•°æ®
    
    Args:
        project_summary: é¡¹ç›®æ¦‚è¿°æ–‡æœ¬
        project_root: é¡¹ç›®æ ¹ç›®å½•
        most_core_source_code_file_list: æ ¸å¿ƒæ–‡ä»¶åˆ—è¡¨ï¼ˆç›¸å¯¹è·¯å¾„ï¼‰
                                         åªæå–å…ƒæ•°æ®ï¼Œä¸åŒ…å«æºç 
    """
```

### 2. `merge_from_files_with_metadata()` æ–¹æ³•å¢å¼º

**æ–°å¢å‚æ•°ï¼š**
- `include_file_text`: æ˜¯å¦åŒ…å«å®Œæ•´æ–‡ä»¶æºç ï¼ˆé»˜è®¤ Trueï¼‰

**åŠŸèƒ½ï¼š**
æ§åˆ¶æ˜¯å¦è¾“å‡ºå®Œæ•´æºç ï¼š
- `include_file_text=True`: å…ƒæ•°æ® + å®Œæ•´æºç ï¼ˆé»˜è®¤ï¼ŒåŸæœ‰è¡Œä¸ºï¼‰
- `include_file_text=False`: åªæœ‰å…ƒæ•°æ®ï¼Œæ²¡æœ‰æºç ï¼ˆæ–°åŠŸèƒ½ï¼‰

```python
def merge_from_files_with_metadata(
    self,
    project_root: typing.Union[os.PathLike, str],
    relative_file_name_list: typing.List[str],
    as_title: str,
    include_ast_metadata: bool = True,
    include_file_text: bool = True,  # æ–°å¢å‚æ•°
) -> "AiMdGenerator":
    """
    Args:
        include_file_text: æ˜¯å¦åŒ…å«å®Œæ•´æ–‡ä»¶æºç 
                          False æ—¶åªæ˜¾ç¤ºå…ƒæ•°æ®ï¼Œä¸æ˜¾ç¤ºæºç 
    """
```

## ğŸ’¡ ä½¿ç”¨åœºæ™¯

### åœºæ™¯ 1: åœ¨é¡¹ç›®æ¦‚è¿°ä¸­å±•ç¤ºæ ¸å¿ƒå…¥å£

```python
from nb_path import AiMdGenerator

(
    AiMdGenerator("my_project_docs.md")
    .set_project_name("my_project")
    .clear_text()
    
    # 1. æ·»åŠ æ¦‚è¿° + æ ¸å¿ƒæ–‡ä»¶å…ƒæ•°æ®ï¼ˆä¸å«æºç ï¼‰
    .add_project_summary(
        project_summary=\"""
        è¿™æ˜¯ä¸€ä¸ª FastAPI Web API é¡¹ç›®ã€‚
        æ ¸å¿ƒåŠŸèƒ½ï¼šç”¨æˆ·ç®¡ç†ã€æ•°æ®åˆ†æã€æŠ¥è¡¨ç”Ÿæˆã€‚
        \""",
        project_root="/path/to/project",
        most_core_source_code_file_list=[
            "src/main.py",           # ä¸»å…¥å£
            "src/api/routes.py",     # API è·¯ç”±
            "src/models/user.py",    # æ ¸å¿ƒæ¨¡å‹
        ],
    )
    
    # 2. åé¢å†æ·»åŠ è¯¦ç»†ä»£ç 
    .merge_from_dir(
        project_root="/path/to/project",
        relative_dir_name="src",
        as_title="è¯¦ç»†æºä»£ç ",
        include_ast_metadata=True,
    )
)
```

### åœºæ™¯ 2: ç”Ÿæˆ API æ¦‚è§ˆæ–‡æ¡£ï¼ˆåªè¦ç»“æ„ï¼‰

```python
(
    AiMdGenerator("api_overview.md")
    .set_project_name("my_api")
    .clear_text()
    
    # åªæå– API ç›¸å…³æ–‡ä»¶çš„å…ƒæ•°æ®
    .merge_from_files_with_metadata(
        project_root="/path/to/project",
        relative_file_name_list=[
            "src/api/routes.py",
            "src/api/handlers.py",
            "src/api/middleware.py",
        ],
        as_title="API æ ¸å¿ƒæ–‡ä»¶ç»“æ„",
        include_ast_metadata=True,
        include_file_text=False,  # ğŸ”‘ åªè¦å…ƒæ•°æ®
    )
)
```

### åœºæ™¯ 3: å…ˆæ¦‚è§ˆåè¯¦ç»†

```python
(
    AiMdGenerator("complete_docs.md")
    .set_project_name("my_project")
    .clear_text()
    
    # ç¬¬ä¸€éƒ¨åˆ†ï¼šæ ¸å¿ƒæ–‡ä»¶æ¦‚è§ˆï¼ˆæ— æºç ï¼‰
    .merge_from_files_with_metadata(
        project_root="/path/to/project",
        relative_file_name_list=["src/main.py", "src/api.py"],
        as_title="æ ¸å¿ƒå…¥å£æ¦‚è§ˆ",
        include_ast_metadata=True,
        include_file_text=False,
    )
    
    # ç¬¬äºŒéƒ¨åˆ†ï¼šè¯¦ç»†å®ç°ï¼ˆæœ‰æºç ï¼‰
    .merge_from_files_with_metadata(
        project_root="/path/to/project",
        relative_file_name_list=["src/utils/helpers.py"],
        as_title="å·¥å…·å‡½æ•°è¯¦ç»†ä»£ç ",
        include_ast_metadata=True,
        include_file_text=True,
    )
)
```

## ğŸ“Š ç”Ÿæˆæ•ˆæœç¤ºä¾‹

### å¯¹äºæ ¸å¿ƒæ–‡ä»¶ `src/main.py`:

```python
# src/main.py
from fastapi import FastAPI

app = FastAPI()

def init_app() -> FastAPI:
    """åˆå§‹åŒ–åº”ç”¨"""
    return app

def main():
    """ä¸»å…¥å£"""
    import uvicorn
    uvicorn.run(app, host="0.0.0.0", port=8000)

if __name__ == "__main__":
    main()
```

### ä½¿ç”¨ `include_file_text=False` ç”Ÿæˆï¼š

```markdown
### ğŸ“„ Python File Metadata: `src/main.py`

#### ğŸ“¦ Imports
- `from fastapi import FastAPI`

#### ğŸ”§ Public Functions (2)

- `def init_app() -> FastAPI`
  - *Line: 5*
  - *åˆå§‹åŒ–åº”ç”¨*

- `def main()`
  - *Line: 9*
  - *ä¸»å…¥å£*

---
```

**æ³¨æ„ï¼šæ²¡æœ‰å®Œæ•´æºç ï¼**

### ä½¿ç”¨ `include_file_text=True`ï¼ˆé»˜è®¤ï¼‰ç”Ÿæˆï¼š

```markdown
--- **start of file: src/main.py** ---

### ğŸ“„ Python File Metadata: `src/main.py`
ï¼ˆå…ƒæ•°æ®åŒä¸Š...ï¼‰

---

```python
# src/main.py
from fastapi import FastAPI
ï¼ˆå®Œæ•´æºç ...ï¼‰
```

--- **end of file: src/main.py** ---
```

## ğŸ“ˆ Token èŠ‚çœæ•ˆæœ

### å¯¹æ¯”æµ‹è¯•ï¼š

| æ–‡ä»¶ | åŒ…å«æºç  | åªè¦å…ƒæ•°æ® | èŠ‚çœ |
|------|---------|-----------|------|
| main.py (200è¡Œ) | ~2000 tokens | ~300 tokens | 85% |
| routes.py (500è¡Œ) | ~5000 tokens | ~500 tokens | 90% |
| models.py (300è¡Œ) | ~3000 tokens | ~400 tokens | 87% |
| **æ€»è®¡ (3ä¸ªæ–‡ä»¶)** | **~10000 tokens** | **~1200 tokens** | **88%** |

ğŸ’¡ **å¯¹äº 5 ä¸ªæ ¸å¿ƒæ–‡ä»¶ï¼Œå¯ä»¥èŠ‚çœçº¦ 90% çš„ tokensï¼**

## ğŸ¯ é€‚ç”¨åœºæ™¯

### âœ… æ¨èä½¿ç”¨

1. **å¤§å‹é¡¹ç›®æ¦‚è§ˆ**
   - å…ˆå±•ç¤ºæ ¸å¿ƒå…¥å£çš„ç»“æ„
   - AI å¿«é€Ÿç†è§£é¡¹ç›®æ¶æ„
   
2. **API æ–‡æ¡£ç”Ÿæˆ**
   - åªéœ€è¦æ¥å£ç­¾å
   - ä¸éœ€è¦å®ç°ç»†èŠ‚

3. **ä»£ç å®¡æŸ¥å‡†å¤‡**
   - å…ˆäº†è§£æ•´ä½“ç»“æ„
   - å†å†³å®šæ·±å…¥å“ªäº›éƒ¨åˆ†

4. **å­¦ä¹ æ–°é¡¹ç›®**
   - å…ˆçœ‹æ ¸å¿ƒå…¥å£
   - é€æ­¥æ·±å…¥ç»†èŠ‚

### âŒ ä¸æ¨èä½¿ç”¨

1. **éœ€è¦å®Œæ•´ä»£ç ** - ä»£ç ç”Ÿæˆã€bug ä¿®å¤ç­‰
2. **å°å‹é¡¹ç›®** - æ–‡ä»¶å°‘ï¼Œç›´æ¥çœ‹æºç æ›´å¿«
3. **å•æ–‡ä»¶åˆ†æ** - ä¸éœ€è¦æ¦‚è§ˆ

## ğŸ” å®ç°ç»†èŠ‚

### `add_project_summary` é€»è¾‘ï¼š

```python
1. æ·»åŠ é¡¹ç›®æ¦‚è¿°æ–‡æœ¬
2. å¦‚æœæä¾›äº† most_core_source_code_file_list:
   a. æ·»åŠ  "Core Source Files Metadata" æ ‡é¢˜
   b. éå†æ¯ä¸ªæ ¸å¿ƒæ–‡ä»¶
   c. è°ƒç”¨ _parse_python_file_ast() æå–å…ƒæ•°æ®
   d. è°ƒç”¨ _format_py_metadata_as_markdown() æ ¼å¼åŒ–
   e. åªè¾“å‡ºå…ƒæ•°æ®ï¼Œä¸è¾“å‡ºæºç 
```

### `merge_from_files_with_metadata` é€»è¾‘ï¼š

```python
if include_file_text == False:
    # åªè¾“å‡ºå…ƒæ•°æ®
    if suffix == ".py" and include_ast_metadata:
        æå–å¹¶è¾“å‡ºå…ƒæ•°æ®
    è·³è¿‡æ–‡ä»¶å†…å®¹
else:
    # æ­£å¸¸æµç¨‹ï¼šå…ƒæ•°æ® + æºç 
    è¾“å‡º "start of file" æ ‡è®°
    if include_ast_metadata:
        è¾“å‡ºå…ƒæ•°æ®
    è¾“å‡ºå®Œæ•´æºç 
    è¾“å‡º "end of file" æ ‡è®°
```

## ğŸ‰ æ€»ç»“

ç°åœ¨æœ‰ **ä¸‰ç§æ¨¡å¼** æ¥å¤„ç† Python æ–‡ä»¶ï¼š

| æ¨¡å¼ | å‚æ•°è®¾ç½® | è¾“å‡ºå†…å®¹ | é€‚ç”¨åœºæ™¯ |
|------|----------|---------|---------|
| **æ¦‚è§ˆæ¨¡å¼** | `include_file_text=False` | åªæœ‰å…ƒæ•°æ® | é¡¹ç›®æ¦‚è¿°ã€API æ–‡æ¡£ |
| **å®Œæ•´æ¨¡å¼** | `include_file_text=True`<br>`include_ast_metadata=True` | å…ƒæ•°æ® + æºç  | ä»£ç å®¡æŸ¥ã€å­¦ä¹  |
| **çº¯æºç æ¨¡å¼** | `include_file_text=True`<br>`include_ast_metadata=False` | åªæœ‰æºç  | ä¼ ç»Ÿæ–¹å¼ |

**æ ¸å¿ƒä»·å€¼ï¼š**
- ğŸš€ è®© AI å…ˆçœ‹æ‡‚ç»“æ„ï¼Œå†æ·±å…¥ç»†èŠ‚
- ğŸ’° èŠ‚çœ 90% çš„ tokens
- ğŸ“– æ›´æ¸…æ™°çš„æ–‡æ¡£ç»„ç»‡
- ğŸ¯ é€‚åˆå¤§å‹é¡¹ç›®å’Œ API æ–‡æ¡£

ç°åœ¨å°±å¯ä»¥ä½¿ç”¨äº†ï¼ğŸŠ

---

## ğŸ“ ç›¸å…³æ–‡ä»¶

- `nb_path/ai_md_generator.py` - æ ¸å¿ƒå®ç°
- `tests/ai_codes/demo_core_files_usage.py` - ä½¿ç”¨ç¤ºä¾‹
- `tests/ai_docs/æ ¸å¿ƒæ–‡ä»¶å…ƒæ•°æ®åŠŸèƒ½.md` - æœ¬æ–‡æ¡£

